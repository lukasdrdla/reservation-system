generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TenantCategory {
  RESTAURANT
  WELLNESS_SPA
  BARBERSHOP
  FITNESS_SPORT
}

enum BookingStatus {
  CONFIRMED
  CANCELLED
  COMPLETED
}

model Tenant {
  id            String          @id @default(uuid()) @db.Uuid
  slug          String          @unique @db.VarChar(100)
  name          String          @db.VarChar(255)
  email         String          @db.VarChar(255)
  phone         String?         @db.VarChar(50)
  logoUrl       String?         @map("logo_url") @db.VarChar(500)
  primaryColor  String          @default("#0066FF") @map("primary_color") @db.VarChar(7)

  // NOVÉ POLE pro kategorii
  category      TenantCategory  @default(WELLNESS_SPA)

  // Category-specific data jako JSON
  // Pro Restaurace: { tableCount: number, seatingCapacity: number, cuisineType?: string }
  // Pro Wellness: { roomCount: number, procedureTypes: string[], therapists?: Array<{id, name}> }
  // Pro Barbershop: { chairCount: number, stylists: Array<{id, name, specialties}> }
  // Pro Fitness: { trainers: Array<{id, name, specialties}>, activityTypes: string[], groupSizeLimit?: number }
  categoryData  Json?           @map("category_data")

  createdAt     DateTime        @default(now()) @map("created_at")

  services      Service[]
  workingHours  WorkingHours[]
  bookings      Booking[]
  blockedTimes  BlockedTime[]

  @@map("tenants")
}

model Service {
  id          String   @id @default(uuid()) @db.Uuid
  tenantId    String   @map("tenant_id") @db.Uuid
  name        String   @db.VarChar(255)
  duration    Int      // v minutách
  price       Int      // v Kč
  description String?  @db.Text
  active      Boolean  @default(true)

  // NOVÉ POLE pro category-specific vlastnosti služby
  // Pro Restaurace: { tableNumber?: number, personCount?: number }
  // Pro Wellness: { procedureType?: string, roomId?: string }
  // Pro Barbershop: { serviceType?: string, preferredStylistId?: string }
  // Pro Fitness: { activityType?: string, trainerId?: string, groupSize?: number }
  serviceData Json?    @map("service_data")

  createdAt   DateTime @default(now()) @map("created_at")

  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  bookings    Booking[]

  @@index([tenantId])
  @@index([active])
  @@map("services")
}

model WorkingHours {
  id         String   @id @default(uuid()) @db.Uuid
  tenantId   String   @map("tenant_id") @db.Uuid
  dayOfWeek  Int      @map("day_of_week") // 0=neděle, 1=pondělí, ...
  startTime  String   @map("start_time") @db.VarChar(5) // HH:MM format
  endTime    String   @map("end_time") @db.VarChar(5)
  isWorking  Boolean  @default(true) @map("is_working")

  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, dayOfWeek])
  @@index([tenantId])
  @@map("working_hours")
}

model Booking {
  id            String        @id @default(uuid()) @db.Uuid
  tenantId      String        @map("tenant_id") @db.Uuid
  serviceId     String        @map("service_id") @db.Uuid
  customerName  String        @map("customer_name") @db.VarChar(255)
  customerEmail String        @map("customer_email") @db.VarChar(255)
  customerPhone String        @map("customer_phone") @db.VarChar(50)
  date          DateTime      @db.Date
  startTime     String        @map("start_time") @db.VarChar(5)
  endTime       String        @map("end_time") @db.VarChar(5)
  status        BookingStatus @default(CONFIRMED)
  note          String?       @db.Text

  // NOVÉ POLE pro category-specific booking data
  // Pro Restaurace: { tableNumber: number, personCount: number, specialRequests?: string }
  // Pro Wellness: { procedureType: string, roomNumber: string, therapistName?: string }
  // Pro Barbershop: { stylistId: string, stylistName: string, serviceType: string }
  // Pro Fitness: { trainerId: string, trainerName: string, activityType: string, participantCount?: number }
  bookingData   Json?         @map("booking_data")

  createdAt     DateTime      @default(now()) @map("created_at")

  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  service       Service       @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([date])
  @@index([status])
  @@map("bookings")
}

model BlockedTime {
  id        String    @id @default(uuid()) @db.Uuid
  tenantId  String    @map("tenant_id") @db.Uuid
  date      DateTime  @db.Date
  startTime String?   @map("start_time") @db.VarChar(5) // NULL = celý den
  endTime   String?   @map("end_time") @db.VarChar(5)
  reason    String?   @db.VarChar(255)

  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([date])
  @@map("blocked_times")
}

// NOVÁ: User model pro NextAuth
model User {
  id            String    @id @default(uuid()) @db.Uuid
  email         String    @unique
  password      String    // hashed with bcrypt
  name          String?
  role          String    @default("tenant") // tenant, admin
  tenantId      String?   @map("tenant_id") @db.Uuid // link k tenantovi
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  @@map("users")
}
